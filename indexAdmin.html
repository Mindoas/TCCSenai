<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administração</title>
    <link rel="stylesheet" href="styleAdmin.css">
</head>
<body>
    <div class="sidebar">
        <div class="title">
            <h1>Painel Administrador</h1>
        </div>
         <div class="blank-space">
            <div class="container">
                <!-- Tabela para exibir dados -->
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>NOME</th>
                            <th>SÉRIE</th>
                            <th>HORÁRIO</th>
                            <th>STATUS</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- As linhas da tabela serão adicionadas aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="content">
        <div class="options">
            <h2>OPÇÕES</h2>
            <button class="back-button" onclick="location.href='index.html'">Voltar ao Inicio</button>
            <button class="add" id="open-popup">Adicionar Cartão</button>
            <button class="view" id="view-cards">Ver Cadastros</button>
            <button class="impr" id="popup-impr-cards">Concluir</button>
            
            
        </div>
        <div class="central">
            <div class="carousel">
                <div class="carousel-container">
                    <div class="carousel-slide">
                        <a href="https://www.sesisp.org.br/noticia/sesi-sp-oferece-bolsas-integrais-a-alunos-nas-melhores-universidades-do-mundo">
                            <img src="https://cronos-media.sesisenaisp.org.br/api/media/1-0/files?img=img_65_240808_6ed6a63f-cdda-41a0-9056-3c7063c68817_o.jpg&tipo=p" alt="Notícia SESI-SP">
                            <p>SESI-SP oferece bolsas integrais a alunos nas melhores universidades do mundo</p>
                        </a>
                    </div>
                    <div class="carousel-slide">
                        <a href="https://www.sesisp.org.br/noticia/sesi-araraquara-basquete-conquista-o-bicampeonato-da-lbf-caixa-e-mantem-sequencia-de-titulos">
                            <img src="https://cronos-media.sesisenaisp.org.br/api/media/1-0/files?img=img_64_240724_050c4a6e-1296-46f7-b243-1e8d36098404_o.jpeg&tipo=p" alt="Notícia SESI-SP">
                            <p>SESI Araraquara basquete conquista o bicampeonato da LBF caixa e mantém sequência de títulos</p>
                        </a>
                    </div>
                    <div class="carousel-slide">
                        <a href="https://www.sesisp.org.br/noticia/outra-vez-no-topo-sesi-franca-basquete-e-tricampeao-do-nbb-2023/24">
                            <img src="https://cronos-media.sesisenaisp.org.br/api/media/1-0/files?img=img_64_240614_1d31955a-450b-4fea-a8cb-04b914bedbe7_o.jpg&tipo=p" alt="Notícia SESI-SP">
                            <p>Outra vez no topo: Sesi Franca Basquete é tricampeão do NBB 2023/24</p>
                        </a>
                    </div>
                    <div class="carousel-slide">
                        <a href="https://www.sesisp.org.br/noticia/a-incrivel-viagem-do-quintal">
                            <img src="https://cronos-media.sesisenaisp.org.br/api/media/1-0/files?img=img_66_240807_e2d9f6d1-a921-4dde-8a2f-d31663bf3493_o.avif" alt="Notícia SESI-SP">
                            <p>Sucesso na TV, programa Quintal da Cultura vira musical encenado no Teatro do SESI-SP</p>
                        </a>
                    </div>
                    <div class="carousel-slide">
                        <a href="https://www.sesisp.org.br/noticia/ao-vivo-dentro-da-cabeca-de-alguem">
                            <img src="https://cronos-media.sesisenaisp.org.br/api/media/1-0/files?img=img_66_240813_33bd7b4e-da0f-4b1c-a6e4-d824188b9390_o.avif" alt="Notícia SESI-SP">
                            <p>Companhia brasileira de teatro estreia sua nova peça no Teatro do SESI-SP
                            </p>
                        </a>
                    </div>
                    
                </div>
                <button class="carousel-button prev" onclick="prevSlide()">&#10094;</button>
                <button class="carousel-button next" onclick="nextSlide()">&#10095;</button>
            </div>
            
        </div>
        <div id="clock-container" class="digital-clock">
            <span id="date"></span> <span id="clock"></span>
        </div>
    </div>

    <!-- O Pop-Up de Adicionar Cartão -->
    <div id="popup-add-card" class="popup">
        <div class="popup-content">
            <span class="close-btn" id="close-add-card">&times;</span>
            <h2>Adicionar Cartão</h2>
            <form id="card-form">
                <label for="card-name">NOME</label>
                <input type="text" id="card-name" name="card-name" required><br>
                
                <label for="card-info">ID</label>
                <input type="text" id="card-info" name="card-info" required><br>
                
                <label for="card-serie">SERIE</label>
                <select id="card-serie" name="card-serie" required>
                    <option value="1EF">1º Ano EF</option>
                    <option value="2EF">2º Ano EF</option>
                    <option value="3EF">3º Ano EF</option>
                    <option value="4EF">4º Ano EF</option>
                    <option value="5EF">5º Ano EF</option>
                    <option value="6EF">6º Ano EF</option>
                    <option value="7EF">7º Ano EF</option>
                    <option value="8EF">8º Ano EF</option>
                    <option value="9EF">9º Ano EF</option>
                    <option value="1EM">1º Ano EM</option>
                    <option value="2EM">2º Ano EM</option>
                    <option value="3EM">3º Ano EM</option>
                </select><br>
                
                <button type="submit">Adicionar</button>
            </form>
        </div>
    </div>
    

    <!-- O Pop-Up de Ver Cartões -->
<div id="popup-view-cards" class="popup">
    <div class="popup-content">
        <span class="close-btn" id="close-view-cards">&times;</span>
        <h2>Lista de Cartões</h2>
        <div class="search-container">
            <input type="text" id="search-input" placeholder="Pesquisar por nome ou código...">
            <button id="search-button">Buscar</button>
        </div>
        <ul id="view-card-list">
            <!-- Lista de cartões será inserida aqui -->
        </ul>
    </div>
</div>

<!-- O pop-up imprimir -->
<div id="popup-impr-cards-popup" class="popup">
    <div class="popup-content">
        <span class="close-btn" id="close-impr-cards">&times;</span>
        <h2>Imprimir Relatório</h2>
        <form id="report-form" action="rel_completo.php" method="GET">
            <label for="filtro-impr">Filtrar</label>
            <select id="filtro-impr" name="filtro-impr" required>
                <option value="">Selecione um filtro</option>
                <option value="Completo">Completo (dia)</option>
                <option value="Serie">Por Série</option>
                <option value="Nome">Por Nome</option>
                <option value="codigo">Por Id</option>
                <option value="Entrada">Por Entrada</option>
                <option value="Saida">Por Saída</option>
                <option value="Ausente">Ausentes</option>
            </select><br>

            <div id="sub-filtro-container" style="display: none;">
                <label for="sub-filtro">Detalhamento</label>
                <select id="sub-filtro" name="sub-filtro">
                    <!-- Opções serão preenchidas dinamicamente -->
                </select><br>
            </div>

            <div id="input-container" style="display: none;">
                <label for="search-input" id="input-label"></label>
                <input type="text" id="search-input" name="search-input" placeholder="Digite aqui...">
            </div><br>
            <div class="botao">
            <button type="submit">Imprimir</button>
            <button type="button" id="reset-filters">Resetar Filtros</button>
            <button type="button" id="set-status-absent">Finalizar Dia</button>
            </div>
        </form>
    </div>
</div>

    <script>

function verificarTeclaEnter(event) {
    if (event.key === "Enter") {
        const codigoAluno = document.getElementById("codigoAluno").value;                
        fetch('backindex.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ codigo: codigoAluno })
        })
        .then(response => response.json())
        .then(data => {
            if (data.existe) {
                console.log(data);
                document.getElementById("nomeAluno").innerText = data.nome;
                nomesArmazenados.push(data.nome);
                localStorage.setItem('nomes', JSON.stringify(nomesArmazenados));
                atualizarListaNomes();
            } else {
                document.getElementById("nomeAluno").innerText = "Código não encontrado!";
            }
        })
        .catch(error => {
            console.error('Erro:', error);
        });
    }
}

// Função para atualizar a lista de nomes
function atualizarListaNomes() {
    const listaNomes = document.getElementById("listaNomes");
    listaNomes.innerHTML = ""; // Limpa a lista
    nomesArmazenados.forEach(nome => {
        const li = document.createElement("li");
        li.textContent = nome;
        listaNomes.appendChild(li);
    });
}


// Atualiza a lista ao carregar a página
document.addEventListener('DOMContentLoaded', () => {
    const armazenados = localStorage.getItem('nomes');
       
        if (armazenados) {
            nomesArmazenados = JSON.parse(armazenados);
            atualizarListaNomes();
        }
});



        // Selecionar elementos para o pop-up de adicionar cartão
        const openAddCardPopup = document.getElementById('open-popup');
        const popupAddCard = document.getElementById('popup-add-card');
        const closeAddCardPopup = document.getElementById('close-add-card');
        const form = document.getElementById('card-form');
    
        // Selecionar elementos para o pop-up de ver cartões
        const viewCardsButton = document.getElementById('view-cards');
        const popupViewCards = document.getElementById('popup-view-cards');
        const closeViewCardsPopup = document.getElementById('close-view-cards');
        const viewCardList = document.getElementById('view-card-list');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
    
        // Função para abrir o pop-up de adicionar cartão
        openAddCardPopup.addEventListener('click', () => {
            popupAddCard.style.display = 'block';
        });
    
        // Função para fechar o pop-up de adicionar cartão
        closeAddCardPopup.addEventListener('click', () => {
            popupAddCard.style.display = 'none';
        });
    
        // Função para abrir o pop-up de ver cartões
        viewCardsButton.addEventListener('click', () => {
            popupViewCards.style.display = 'block';
            loadCardList(); // Carregar cartões ao abrir o pop-up
        });
    
        // Função para fechar o pop-up de ver cartões
        closeViewCardsPopup.addEventListener('click', () => {
            popupViewCards.style.display = 'none';
        });
    
        // Fechar o pop-up quando clicar fora do conteúdo
        window.addEventListener('click', (event) => {
            if (event.target === popupAddCard) {
                popupAddCard.style.display = 'none';
            }
            if (event.target === popupViewCards) {
                popupViewCards.style.display = 'none';
            }
        });
    
        // Manipulador de envio do formulário de adicionar cartão
        form.addEventListener('submit', (event) => {
            event.preventDefault(); // Impede o envio padrão do formulário
    
            // Obtendo dados do formulário
            const formData = new FormData(form);
    
            // Enviando dados via AJAX
            fetch('save_card.php', {
                method: 'POST',
                body: formData
            })
                .then(response => response.text()) // Recebe como texto para depuração
                .then(text => {
                    try {
                        const data = JSON.parse(text); // Tenta parsear como JSON
                        if (data.status === 'success') {
                            alert(data.message);
                            popupAddCard.style.display = 'none'; // Fecha o pop-up
                            form.reset(); // Reseta o formulário
                            loadCards(); // Recarrega a lista de cartões
                        } else {
                            alert(data.message);
                        }
                    } catch (error) {
                        console.error('Erro de parsing JSON:', error);
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro ao salvar o cartão.');
                });
        });
    
        // Função para carregar e exibir os cartões na lista principal
function loadCards() {
    fetch('get_cards.php')
        .then(response => response.json())
        .then(data => {
            const cardList = document.getElementById('card-list');
            cardList.innerHTML = ''; // Limpa a lista existente
            nomesArmazenados = []; // Reseta nomesArmazenados
            seriesArmazenadas = []; // Reseta seriesArmazenadas
            statusArmazenados = []; // reseta statusArmazenados

            data.forEach(card => {
                const li = document.createElement('li');
                li.innerHTML = `${card.nome}: ${card.info}: ${card.serie}: ${card.status} <button class="delete-button" onclick="deleteCard(${card.id})">Excluir</button>`;
                cardList.appendChild(li);

                // Adiciona o nome e a série às variáveis de armazenamento
                nomesArmazenados.push(card.nome);
                seriesArmazenadas.push(card.serie);
                statusArmazenados.push(card.status);
            });
        })
        .catch(error => {
            console.error('Erro:', error);
            // alert('Erro ao carregar os cartões.');
        });
}

    
        // Função para carregar e exibir os cartões na lista de ver cartões
        function loadCardList(searchTerm = '') {
            fetch('get_cards.php?search=' + encodeURIComponent(searchTerm))
                .then(response => response.text()) // Recebe como texto para depuração
                .then(text => {
                    try {
                        const data = JSON.parse(text); // Tenta parsear como JSON
                        viewCardList.innerHTML = ''; // Limpa a lista existente
                        data.forEach(card => {
                            const li = document.createElement('li');
                            li.innerHTML = `${card.nome}: ${card.info} <button class="delete-button" onclick="deleteCard(${card.id})">Excluir</button>`;
                            viewCardList.appendChild(li);
                        });
                    } catch (error) {
                        console.error('Erro de parsing JSON:', error);
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro ao carregar os cartões.');
                });
        }
    
        // Função para excluir um cartão
        function deleteCard(id) {
            if (confirm('Tem certeza de que deseja excluir este cartão?')) {
                fetch('delete_card.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        'id': id
                    })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erro na resposta do servidor: ' + response.statusText);
                        }
                        return response.text(); // Recebe a resposta como texto para depuração
                    })
                    .then(text => {
                        try {
                            const data = JSON.parse(text); // Tenta parsear como JSON
                            if (data.status === 'success') {
                                alert(data.message);
                                loadCards(); // Recarrega a lista de cartões
                                loadCardList(); // Recarrega a lista de cartões no pop-up de visualização
                            } else {
                                alert(data.message);
                            }
                        } catch (error) {
                            console.error('Erro de parsing JSON:', error);
                    
                        }
                    })
                    .catch(error => {
                        console.error('Erro:', error);
                        alert('Erro ao excluir o cartão.');
                    });
            }
        }
    
        // Manipulador do botão de pesquisa
        searchButton.addEventListener('click', () => {
            const searchTerm = searchInput.value.trim();
            loadCardList(searchTerm); // Carregar cartões filtrados com base na pesquisa
        });

        // Carregar cartões ao abrir a página
       // window.addEventListener('load', loadCards);

        function updateClock() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    const timeString = `${hours}:${minutes}:${seconds}`;
    
    document.getElementById('clock').textContent = timeString;

    // Atualiza a data no formato numérico (dd/mm/yyyy)
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Mês começa do 0
    const year = now.getFullYear();
    const dateString = `${day}/${month}/${year}`;
    
    document.getElementById('date').textContent = dateString;
}


setInterval(updateClock, 1000); // Atualiza o relógio a cada segundo
updateClock(); // Chama a função imediatamente ao carregar a página

        let currentSlide = 0;

function showSlide(index) {
    const slides = document.querySelector('.carousel-container');
    const totalSlides = document.querySelectorAll('.carousel-slide').length;

    if (index >= totalSlides) {
        currentSlide = 0;
    } else if (index < 0) {
        currentSlide = totalSlides - 1;
    } else {
        currentSlide = index;
    }

    slides.style.transform = `translateX(-${currentSlide * 100}%)`;
}

function nextSlide() {
    showSlide(currentSlide + 1);
}

function prevSlide() {
    showSlide(currentSlide - 1);
}

// Optionally, you can add automatic slide transition
setInterval(nextSlide, 8000);

// Função para procurar e exibir a série correspondente a um nome
function procurarSerie(nome) {
    const index = nomesArmazenados.indexOf(nome);
    if (index !== -1) {
        // Encontrou o nome, então mostra a série correspondente
        const serie = seriesArmazenadas[index];
        atualizarListaSeries([serie]); // Atualiza a lista com a série encontrada
    } else {
        // Nome não encontrado
        atualizarListaSeries([]);
    }
}

// Função para atualizar a lista de séries
function atualizarListaSeries(series) {
    const listaSerie = document.getElementById("listaSerie");
    listaSerie.innerHTML = ""; // Limpa a lista existente
    series.forEach(serie => {
        const li = document.createElement("li");
        li.textContent = serie;
        listaSerie.appendChild(li);
    });
    
}

// Função para carregar e exibir dados da tabela
let cardsData = {}; // Objeto para armazenar os cartões com suas informações

function loadTableData() {
    fetch('get_painel_adm.php')
        .then(response => response.json())
        .then(data => {
            console.log(data); // Verifique os dados no console

            const tableBody = document.getElementById("table-body");
            tableBody.innerHTML = ""; // Limpa a tabela existente

            // Preenche a tabela com os dados recebidos
            data.forEach(item => {
                const row = document.createElement("tr");

                const cellNome = document.createElement("td");
                cellNome.textContent = item.nome;
                row.appendChild(cellNome);

                const cellSerie = document.createElement("td");
                cellSerie.textContent = item.serie;
                row.appendChild(cellSerie);

                const cellHora = document.createElement("td");
                cellHora.textContent = item.horario;
                row.appendChild(cellHora);

                const cellStatus = document.createElement("td");
                cellStatus.textContent = item.status;
                row.appendChild(cellStatus);

                tableBody.appendChild(row);
            });
        })
        .catch(error => {
            console.error('Erro ao carregar os dados:', error);
        });
}


// Função para obter o texto do status com base no valor do flag
function getStatusText(flag) {
    if (flag === 1) return "ENTRADA";
    if (flag === 2) return "SAIDA";
    return " ";
}

        // Carregar dados ao abrir a página
        window.addEventListener('load', loadTableData);

        function printPDF() {
            var iframe = document.createElement('iframe');
            iframe.style.visibility = 'hidden';
            iframe.style.position = 'absolute';
            iframe.src = 'relatorios/rel_completo.php';
            document.body.appendChild(iframe);

            iframe.onload = function() {
                setTimeout(function() {
                    iframe.contentWindow.print();
                }, 500); // Ajuste o tempo de espera se necessário
            };
            window.onload = printPDF;
        }

        document.addEventListener('DOMContentLoaded', function() {
    var btn = document.getElementById('popup-impr-cards');
    var popup = document.getElementById('popup-impr-cards-popup');
    var closeBtn = document.getElementById('close-impr-cards');
    var filtroImpr = document.getElementById('filtro-impr');
    var subFiltro = document.getElementById('sub-filtro');
    var subFiltroContainer = document.getElementById('sub-filtro-container');
    var inputContainer = document.getElementById('input-container');
    var searchInput = document.getElementById('search-input');
    var inputLabel = document.getElementById('input-label');
    var reportForm = document.getElementById('report-form');
    var resetFilters = document.getElementById('reset-filters');
    var setStatusAbsent = document.getElementById('set-status-absent');

    // Função para atualizar o segundo select e os campos de entrada
function updateFilters() {
    var selectedValue = filtroImpr.value;

    // Limpa os filtros anteriores
    subFiltro.innerHTML = '';
    subFiltroContainer.style.display = 'none';
    inputContainer.style.display = 'none';

    if (selectedValue === 'Serie') {
        subFiltroContainer.style.display = 'block';
        var options = [
            '1EF', '2EF', '3EF', '4EF', '5EF',
            '6EF', '7EF', '8EF', '9EF', '1EM',
            '2EM', '3EM'
        ];
        options.forEach(function(optionText) {
            var option = document.createElement('option');
            option.value = optionText;
            option.textContent = optionText;
            subFiltro.appendChild(option);
        });
    } else if (selectedValue === 'Nome') {
        inputLabel.textContent = 'Digite o nome:';
        inputContainer.style.display = 'block';
    } else if (selectedValue === 'codigo') {
        inputLabel.textContent = 'Digite o código:';
        inputContainer.style.display = 'block';
    } else if (selectedValue === 'Ausente') {
        // Adiciona o sub-filtro para Ausentes
        subFiltroContainer.style.display = 'block';
        var options = [
            '1EF', '2EF', '3EF', '4EF', '5EF',
            '6EF', '7EF', '8EF', '9EF', '1EM',
            '2EM', '3EM'
        ];
        options.forEach(function(optionText) {
            var option = document.createElement('option');
            option.value = optionText;
            option.textContent = optionText;
            subFiltro.appendChild(option);
        });
    }
}

// Função para resetar os filtros
function resetFiltersFunction() {
    filtroImpr.value = '';
    subFiltro.innerHTML = '';
    subFiltroContainer.style.display = 'none';
    inputContainer.style.display = 'none';
    searchInput.value = '';
}

filtroImpr.addEventListener('change', updateFilters);

resetFilters.addEventListener('click', function() {
    resetFiltersFunction();
});

setStatusAbsent.addEventListener('click', function() {
    if (confirm("Tem certeza de que deseja definir o status como 'Ausente' e excluir todos os registros?")) {
        window.location.href = 'set_status_absent.php';
    }
});

btn.onclick = function() {
    popup.style.display = 'block';
};

closeBtn.onclick = function() {
    popup.style.display = 'none';
};

window.onclick = function(event) {
    if (event.target == popup) {
        popup.style.display = 'none';
    }
};
});

    </script>
    
</body>

</html>